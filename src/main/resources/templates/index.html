<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Space Mission Control</title>
    <!-- Nhúng Bootstrap 5 để giao diện đẹp ngay lập tức -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Nhúng FontAwesome để có icon đẹp -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-light">

    <!-- Thanh Menu đầu trang -->
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-rocket me-2"></i> Space Mission Manager
            </a>
        </div>
    </nav>

    <div class="container">
        <!-- Tiêu đề và Nút Thêm Mới -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-list-ul text-primary"></i> Mission Dashboard</h2>
        <!-- Thêm th:onclick hoặc bọc thẻ a -->
        <a th:href="@{/showNewMissionForm}" class="btn btn-success">
            <i class="fas fa-plus"></i> Add New Mission
        </a>
        </div>

        <!-- Bảng hiển thị dữ liệu -->
        <div class="card shadow-sm">
            <div class="card-body p-0">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Mission Name</th>
                            <th>Code</th>
                            <th>Destination</th>
                            <th>Launch Year</th>
                            <th>Success Rate</th>
                            <th>Type</th>
                            <th>Crew (Astronauts)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Vòng lặp Thymeleaf: Duyệt qua từng nhiệm vụ trong listMissions -->
                        <tr th:each="mission : ${listMissions}">
                            
                            <td class="fw-bold" th:text="${mission.name}">Apollo 11</td>
                            <td th:text="${mission.code}">AP11</td>
                            <td th:text="${mission.des}">Moon</td>
                            <td th:text="${mission.launchYear}">1969</td>
                            
                            <!-- Hiển thị tỉ lệ thành công -->
                            <td>
                                <span th:text="${mission.getSuccessRate} + '%'" 
                                      th:class="${mission.getSuccessRate >= 90} ? 'badge bg-success' : 'badge bg-warning text-dark'">
                                      100%
                                </span>
                            </td>

                            <!-- Hiển thị loại nhiệm vụ (Manned/Unmanned) -->
                            <td>
                                <span th:if="${mission.isManned}" class="badge rounded-pill bg-primary">
                                    <i class="fas fa-user-astronaut"></i> Manned
                                </span>
                                <span th:unless="${mission.isManned}" class="badge rounded-pill bg-secondary">
                                    <i class="fas fa-robot"></i> Unmanned
                                </span>
                            </td>

                            <!-- Hiển thị danh sách phi hành gia -->
                            <td>
                                <div th:if="${mission.isManned}">
                                    <ul class="list-unstyled mb-0 small">
                                        <!-- BẮT ĐẦU VÒNG LẶP -->
                                        <li th:each="astro : ${mission.astronauts}" class="d-flex justify-content-between align-items-center mb-1">
            
                                            <!-- Cụm hiển thị tên (Bên trái) -->
                                            <div>
                                                <i class="fas fa-user text-secondary"></i> 
                                                <span th:text="${astro.name}">Neil Armstrong</span> 
                                                <span class="text-muted" th:text="'(' + ${astro.nationality} + ')'">(USA)</span>
                                            </div>
            
                                            <!-- Cụm nút bấm Sửa/Xóa (Bên phải) -->
                                            <div>
                                                <a th:href="@{/editAstronaut/{id}(id=${astro.id})}" class="btn btn-link btn-sm p-0" title="Edit">
                                                    <i class="fas fa-edit text-primary"></i>
                                                </a>
                                                <a th:href="@{/deleteAstronaut/{id}(id=${astro.id})}" 
                                                    class="btn btn-link btn-sm p-0 ms-2" 
                                                    onclick="return confirm('Remove this astronaut?')" title="Delete">
                                                    <i class="fas fa-trash text-danger"></i>
                                                </a>
                                            </div>

                                        </li> <!-- KẾT THÚC VÒNG LẶP -->
                                    </ul>
                                </div>
                                <div th:unless="${mission.isManned}" class="text-muted small">
                                    <em>No crew</em>
                                </div>
                            </td>
                            
                            <td>
                                <!-- Nút Edit (Gửi mã code lên URL /edit/...) -->
                                <a th:href="@{/edit/{code}(code=${mission.code})}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-edit"></i> Edit
                                </a>

                                <!-- THÊM NÚT MỚI NÀY: Add Crew -->
                                <a th:href="@{/mission/{code}/addAstronaut(code=${mission.code})}" class="btn btn-warning btn-sm text-dark">
                                    <i class="fas fa-user-plus"></i> Add Crew
                                </a>

                                <!-- Nút Delete (Gửi mã code lên URL /delete/...) -->
                                <!-- onclick để hỏi lại cho chắc chắn -->
                                <a th:href="@{/delete/{code}(code=${mission.code})}" 
                                    class="btn btn-danger btn-sm"
                                    onclick="return confirm('Are you sure you want to delete this mission?')">
                                        <i class="fas fa-trash"></i> Delete
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>